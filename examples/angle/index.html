<!DOCTYPE html>
<html lang="en"><head>
  <script>
    window.ENVIRONMENT = 'production';
  </script>

  <!-- support for mobile touch devices -->
  <meta
    name="viewport"
    content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1"
  />

  <link rel="stylesheet" href="/examples/assets/main.css" />
  <link rel="stylesheet" href="/examples/assets/styles.css" />

  <!-- include the hammer.js library for touch gestures-->
  <script src="https://unpkg.com/hammerjs@2.0.8/hammer.js"></script>
  <script src="https://unpkg.com/dicom-parser@1.8.3/dist/dicomParser.min.js"></script>

  <!-- include the cornerstone library -->
  <script src="https://unpkg.com/cornerstone-core"></script>
  <script src="https://unpkg.com/cornerstone-math"></script>
  <script src="https://unpkg.com/cornerstone-wado-image-loader"></script>

  <!-- Why we're all here ;) -->
  <script src="https://unpkg.com/cornerstone-tools"></script>
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper">
      <a class="site-title" rel="author" href="/examples/">
          Tool Examples
      </a>
  </div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <body>
  <div class="wrapper">
    <h1>Angle Tool</h1>

    <div class="buttons">
      <button class="button set-tool-mode is-primary" data-action="Active">
        Active
      </button>
      <button class="button set-tool-mode" data-action="Passive">
        Passive
      </button>
      <button class="button set-tool-mode" data-action="Enabled">Enable</button>
      <button class="button set-tool-mode" data-action="Disabled">
        Disable
      </button>
    </div>

    <div class="cornerstone-element-wrapper">
      <div
        class="cornerstone-element"
        data-index="0"
        oncontextmenu="return false"
      ></div>
    </div>
  </div>

  <h2 id="how-to-set-up-the-angle-tool">How to set up the Angle tool:</h2>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Init cornerstone tools</span>
<span class="nx">cornerstoneTools</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>

<span class="c1">// Enable any elements, and display images</span>
<span class="c1">// ...</span>

<span class="c1">// Add our tool, and set it's mode</span>
<span class="kd">const</span> <span class="nx">AngleTool</span> <span class="o">=</span> <span class="nx">cornerstoneTools</span><span class="p">.</span><span class="nx">AngleTool</span><span class="p">;</span>

<span class="nx">cornerstoneTools</span><span class="p">.</span><span class="nx">addTool</span><span class="p">(</span><span class="nx">AngleTool</span><span class="p">)</span>
<span class="nx">cornerstoneTools</span><span class="p">.</span><span class="nx">setToolActive</span><span class="p">(</span><span class="s1">'Angle'</span><span class="p">,</span> <span class="p">{</span> <span class="na">mouseButtonMask</span><span class="p">:</span> <span class="mi">1</span> <span class="p">})</span></code></pre></figure>



  <script>
    // NOTE: We pull these in from packaged sources in our header,
    // but here are the associated NPM packages that can be used instead

    // Packages
    // import Hammer from 'hammerjs';
    // import dicomParser from 'dicom-parser';
    // import * as cornerstone from 'cornerstone-core';
    // import * as cornerstoneMath from 'cornerstone-math';
    // import * as cornerstoneWADOImageLoader from 'cornerstone-wado-image-loader';
    // import * as cornerstoneTools from '@cornerstonejs/tools';

    const baseUrl =
      window.ENVIRONMENT === 'development'
        ? 'http://localhost:4000/'
        : 'https://tools.cornerstonejs.org/examples/';

    _initCornerstone();
    _initInterface();

    const element = document.querySelector('.cornerstone-element');

    // Init CornerstoneTools
    cornerstoneTools.init();
    cornerstone.enable(element);
    const toolName = 'Angle';
    const imageIds = [
      `wadouri:${baseUrl}assets/dicom/exotic/1.dcm`,
      `wadouri:${baseUrl}assets/dicom/exotic/2.dcm`,
    ];

    element.tabIndex = 0;
    element.focus();

    cornerstone.loadImage(imageIds[0]).then(function(image) {
      cornerstone.displayImage(element, image);
    });

    // Add the tool
    const apiTool = cornerstoneTools[`${toolName}Tool`];
    cornerstoneTools.addTool(apiTool);
    cornerstoneTools.setToolActive(toolName, { mouseButtonMask: 1 });

    /***************************************************************************
     * UI & Boilerplate setup code
     **************************************************************************/

    /***
     *
     *
     */
    function _initCornerstone() {
      // Externals
      cornerstoneWADOImageLoader.external.cornerstone = cornerstone;
      cornerstoneWADOImageLoader.external.dicomParser = dicomParser;
      cornerstoneTools.external.cornerstoneMath = cornerstoneMath;
      cornerstoneTools.external.cornerstone = cornerstone;
      cornerstoneTools.external.Hammer = Hammer;

      // Image Loader
      const config = {
        webWorkerPath: `${baseUrl}/assets/image-loader/cornerstoneWADOImageLoaderWebWorker.js`,
        taskConfiguration: {
          decodeTask: {
            codecsPath: `${baseUrl}/assets/image-loader/cornerstoneWADOImageLoaderCodecs.js`,
          },
        },
      };
      cornerstoneWADOImageLoader.webWorkerManager.initialize(config);
    }

    /***
     *
     *
     */
    function _initInterface() {
      const handleClick = function(evt) {
        const action = this.dataset.action;
        const options = {
          mouseButtonMask:
            evt.buttons || convertMouseEventWhichToButtons(evt.which),
        };

        cornerstoneTools[`setTool${action}`](toolName, options);

        // Remove active style from all buttons
        const buttons = document.querySelectorAll('.set-tool-mode');
        buttons.forEach(btn => {
          btn.classList.remove('is-primary');
        });

        // Add active style to this button
        this.classList.add('is-primary');

        evt.preventDefault();
        evt.stopPropagation();
        evt.stopImmediatePropagation();
        return false;
      };

      const buttons = document.querySelectorAll('.set-tool-mode');

      buttons.forEach(btn => {
        btn.addEventListener('contextmenu', handleClick);
        btn.addEventListener('auxclick', handleClick);
        btn.addEventListener('click', handleClick);
      });
    }

    const convertMouseEventWhichToButtons = which => {
      switch (which) {
        // no button
        case 0:
          return 0;
        // left
        case 1:
          return 1;
        // middle
        case 2:
          return 4;
        // right
        case 3:
          return 2;
      }
      return 0;
    };
  </script>
</body>

      </div>
    </main>

<footer class="site-footer h-card">
  <data class="u-url" href="/examples/"></data>

  <div class="wrapper">

      <h2 class="footer-heading">Tool Examples</h2>

      <div class="footer-col-wrapper">
          <div class="footer-col">
              <ul class="contact-list">
                  <li class="p-name"></li><li><a class="u-email" href="mailto:danny.ri.brown+cstools@gmail.com">danny.ri.brown+cstools@gmail.com</a></li></ul>
              <p>cornerstone-tools is a light-weight solution for building Tools on top of Cornerstone.js. It&#39;s only dependencies are libraries within the Cornerstone family. Instead of trying to &quot;do everything&quot; it aims to be extensible and pluggable to aid in the rapid development of new tools. Ideally, tools created using cornerstone-tools can be easily shared, allowing for the creation of a broader ecosystem.</p><ul class="social-media-list"><li><a href="https://github.com/cornerstonejs"><svg class="svg-icon"><use xlink:href="/examples/assets/minima-social-icons.svg#github"></use></svg> <span class="username">cornerstonejs</span></a></li></ul>
</div>
      </div>

  </div>

</footer>
</body>

</html>
